<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Nanoc::Helpers::Capturing
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Nanoc.html" title="Nanoc (module)">Nanoc</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Helpers.html" title="Nanoc::Helpers (module)">Helpers</a></span></span>
     &raquo; 
    <span class="title">Capturing</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Nanoc::Helpers::Capturing
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="Filtering.html" title="Nanoc::Helpers::Filtering (module)">Filtering</a></span>, <span class='object_link'><a href="HTMLEscape.html" title="Nanoc::Helpers::HTMLEscape (module)">HTMLEscape</a></span>, <span class='object_link'><a href="Rendering.html" title="Nanoc::Helpers::Rendering (module)">Rendering</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/nanoc/helpers/capturing.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Provides functionality for “capturing” content in one place and reusing
this content elsewhere.</p>

<p>For example, suppose you want the sidebar of your site to contain a short
summary of the item. You could put the summary in the meta file, but
that’s not possible when the summary contains eRuby. You could also put
the sidebar inside the actual item, but that’s not very pretty. Instead,
you write the summary on the item itself, but capture it, and print it in
the sidebar layout.</p>

<p>This helper has been tested with ERB and Haml. Other filters may not work
correctly.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Capturing content for a summary</p>
</div></p>
      
      <pre class="example code"><code>
&lt;% content_for :summary do %&gt;
  &lt;p&gt;On this item, nanoc is introduced, blah blah.&lt;/p&gt;
&lt;% end %&gt;</code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Showing captured content in a sidebar</p>
</div></p>
      
      <pre class="example code"><code>
&lt;div id=&quot;sidebar&quot;&gt;
  &lt;h3&gt;Summary&lt;/h3&gt;
  &lt;%= content_for(@item, :summary) || '(no summary)' %&gt;
&lt;/div&gt;</code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Showing captured content in a sidebar the old, deprecated way (do not use or I will become very angry)</p>
</div></p>
      
      <pre class="example code"><code>
&lt;div id=&quot;sidebar&quot;&gt;
  &lt;h3&gt;Summary&lt;/h3&gt;
  &lt;%= @item[:content_for_summary] || '(no summary)' %&gt;
&lt;/div&gt;</code></pre>
    
  </div>


</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Capturing/CapturesStore.html" title="Nanoc::Helpers::Capturing::CapturesStore (class)">CapturesStore</a></span>
    
  
</p>







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture-instance_method" title="#capture (instance method)">- (String) <strong>capture</strong>(&amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Evaluates the given block and returns its contents.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#content_for-instance_method" title="#content_for (instance method)">- (Object) <strong>content_for</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="capture-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>capture</strong>(&amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Evaluates the given block and returns its contents. The contents of the
block is not outputted.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The captured result</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nanoc/helpers/capturing.rb', line 151</span>

<span class='kw'>def</span> <span class='id identifier rubyid_capture'>capture</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='comment'># Get erbout so far
</span>  <span class='id identifier rubyid_erbout'>erbout</span> <span class='op'>=</span> <span class='id identifier rubyid_eval'>eval</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>_erbout</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_erbout_length'>erbout_length</span> <span class='op'>=</span> <span class='id identifier rubyid_erbout'>erbout</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>

  <span class='comment'># Execute block
</span>  <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span>

  <span class='comment'># Get new piece of erbout
</span>  <span class='id identifier rubyid_erbout_addition'>erbout_addition</span> <span class='op'>=</span> <span class='id identifier rubyid_erbout'>erbout</span><span class='lbracket'>[</span><span class='id identifier rubyid_erbout_length'>erbout_length</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>

  <span class='comment'># Remove addition
</span>  <span class='id identifier rubyid_erbout'>erbout</span><span class='lbracket'>[</span><span class='id identifier rubyid_erbout_length'>erbout_length</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>

  <span class='comment'># Depending on how the filter outputs, the result might be a
</span>  <span class='comment'># single string or an array of strings (slim outputs the latter).
</span>  <span class='id identifier rubyid_erbout_addition'>erbout_addition</span> <span class='op'>=</span> <span class='id identifier rubyid_erbout_addition'>erbout_addition</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='kw'>if</span> <span class='id identifier rubyid_erbout_addition'>erbout_addition</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>

  <span class='comment'># Done.
</span>  <span class='id identifier rubyid_erbout_addition'>erbout_addition</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="content_for-instance_method">
  
    
      <span class="overload">- (<tt>void</tt>) <strong>content_for</strong>(name, &amp;block) </span>
    
      <span class="overload">- (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>content_for</strong>(item, name) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>void</tt>) <strong>content_for</strong>(name, &amp;block) </span>
        <div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Captures the content inside the block and stores it so that it can be
referenced later on. The same method, <span class='object_link'><a href="#content_for-instance_method" title="Nanoc::Helpers::Capturing#content_for (method)">#content_for</a></span>, is used for
getting the captured content as well as setting it. When capturing,
the content of the block itself will not be outputted.</p>

<p>For backwards compatibility, it is also possible to fetch the captured
content by getting the contents of the attribute named <code>content_for_</code>
followed by the given name. This way of accessing captures is
deprecated.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The base name of the attribute into which
the content should be stored</p>
</div>
      
    </li>
  
</ul>


</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>content_for</strong>(item, name) </span>
        <div class="docstring">
  <div class="discussion">
    <p>Fetches the capture with the given name from the given item and
returns it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>item</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Item.html" title="Nanoc::Item (class)">Nanoc::Item</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The item for which to get the capture</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the capture to fetch</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The stored captured content</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nanoc/helpers/capturing.rb', line 100</span>

<span class='kw'>def</span> <span class='id identifier rubyid_content_for'>content_for</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span> <span class='comment'># Set content
</span>    <span class='comment'># Get args
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expected 1 argument (the name </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> 
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>of the capture) but got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rbrace'>}</span><span class='tstring_content'> instead</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>

    <span class='comment'># Capture and store
</span>    <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='id identifier rubyid_capture'>capture</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='ivar'>@site</span><span class='period'>.</span><span class='id identifier rubyid_captures_store'>captures_store</span><span class='lbracket'>[</span><span class='ivar'>@item</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_content'>content</span>
  <span class='kw'>else</span> <span class='comment'># Get content
</span>    <span class='comment'># Get args
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>!=</span> <span class='int'>2</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expected 2 arguments (the item </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>and the name of the capture) but got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rbrace'>}</span><span class='tstring_content'> instead</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>

    <span class='comment'># Create dependency
</span>    <span class='id identifier rubyid_current_item'>current_item</span> <span class='op'>=</span> <span class='ivar'>@site</span><span class='period'>.</span><span class='id identifier rubyid_compiler'>compiler</span><span class='period'>.</span><span class='id identifier rubyid_dependency_tracker'>dependency_tracker</span><span class='period'>.</span><span class='id identifier rubyid_top'>top</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_item'>item</span> <span class='op'>!=</span> <span class='id identifier rubyid_current_item'>current_item</span>
      <span class='const'>Nanoc</span><span class='op'>::</span><span class='const'>NotificationCenter</span><span class='period'>.</span><span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='symbol'>:visit_started</span><span class='comma'>,</span> <span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>
      <span class='const'>Nanoc</span><span class='op'>::</span><span class='const'>NotificationCenter</span><span class='period'>.</span><span class='id identifier rubyid_post'>post</span><span class='lparen'>(</span><span class='symbol'>:visit_ended</span><span class='comma'>,</span>   <span class='id identifier rubyid_item'>item</span><span class='rparen'>)</span>

      <span class='comment'># This is an extremely ugly hack to get the compiler to recompile the
</span>      <span class='comment'># item from which we use content. For this, we need to manually edit
</span>      <span class='comment'># the content attribute to reset it. :(
</span>      <span class='comment'># FIXME clean this up
</span>      <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@site</span><span class='period'>.</span><span class='id identifier rubyid_captures_store_compiled_items'>captures_store_compiled_items</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_item'>item</span>
        <span class='ivar'>@site</span><span class='period'>.</span><span class='id identifier rubyid_captures_store_compiled_items'>captures_store_compiled_items</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_item'>item</span> 
        <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_forced_outdated'>forced_outdated</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_reps'>reps</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
          <span class='id identifier rubyid_raw_content'>raw_content</span> <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_raw_content'>raw_content</span>
          <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='symbol'>:raw</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_raw_content'>raw_content</span><span class='comma'>,</span> <span class='symbol'>:last</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_raw_content'>raw_content</span> <span class='rbrace'>}</span>
          <span class='ivar'>@site</span><span class='period'>.</span><span class='id identifier rubyid_compiler'>compiler</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='symbol'>:compile_rep</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Get content
</span>    <span class='ivar'>@site</span><span class='period'>.</span><span class='id identifier rubyid_captures_store'>captures_store</span><span class='lbracket'>[</span><span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    
<script type="text/javascript">
    var _gaq = _gaq || [];
    var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
    _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
    _gaq.push(['_setAccount', 'UA-15639968-1']);
    _gaq.push(['_setDomainName', 'nanoc.ws']);
    _gaq.push(['_setAllowLinker', true]);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
     })();
</script>

  </body>
</html>